/*
 AngularJS---github-search-demo
 Andrei Cioban
 2014-09-26 
*/
"use strict";var githubApp=angular.module("githubApp",["ngRoute","ngResource","MainCtrl","Utils","Config"]);githubApp.config(["$routeProvider",function(a){a.when("/",{controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("Config",[]).constant("Config",{searchTerm:"Angular",searchCategories:[{name:"repositories"},{name:"users"}]}),angular.module("MainCtrl",[]).controller("MainCtrl",["$scope","$compile","Config","Github","Utils",function(a,b,c,d,e){function f(){var b=h.searchAngularRepos(a.searchTerm,a.searchCategory);b.success(function(b){b&&b.items&&(a.results="repositories"==a.searchCategory?e.extractInfoRepo(b.items):e.extractInfoUser(b.items),g())})}function g(){a.pconfig={currentPage:0,list:a.results,itemsPerPage:6,id:"pagination"},e.paginate(a.pconfig),b(a.pconfig.$editLine)(a)}a.searchTerm=c.searchTerm,a.categories=c.searchCategories,a.searchCategory=c.searchCategories[0].name;var h=new d;f(),a.doSearch=function(){f()}}]),githubApp.directive("onEnter",[function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.onEnter,{event:b})}),b.preventDefault())})}}]),githubApp.directive("myTruncate",[function(){return{link:function(a,b,c){b.text(c.myTruncate.length>10?c.myTruncate.substr(0,8)+"...":c.myTruncate)}}}]),githubApp.filter("offset",function(){return function(a,b){return a?(b=parseInt(b,10),a.slice(b)):void 0}}),githubApp.factory("Github",["$http",function(a){function b(){}return b.prototype.searchAngularRepos=function(b,c){return a.get("https://api.github.com/search/"+c,{params:{q:b}})},b}]),angular.module("Utils",[]).service("Utils",[function(){this.extractInfoRepo=function(a){var b=[];return a.forEach(function(a){var c={},d={};c.title=a.name,c.description=a.description||"No description.",c.createdAt=a.created_at,c.url=a.html_url,c.watchers=a.watchers,c.score=a.score,d.name=a.owner.login,d.avatarUrl=a.owner.avatar_url,d.profileUrl=a.owner.html_url,c.owner=d,b.push(c)}),b},this.extractInfoUser=function(a){var b=[];return a.forEach(function(a){var c={},d={};c.title=a.login,c.description="No description.",c.url=a.html_url,c.score=a.score,d.name=a.type,d.avatarUrl=a.avatar_url,d.profileUrl=a.html_url,c.owner=d,b.push(c)}),b},this.paginate=function(a){a.range=function(){var b,c=15,d=[];b=a.currentPage,b>a.pageCount()-c&&(b=a.pageCount()-c+1);for(var e=b;b+c>e;e++)e>0&&d.push(e);return d},a.pageCount=function(){return Math.ceil(a.list.length/a.itemsPerPage)-1},a.rows=function(){return a.list.length},a.from=function(){return a.currentPage*a.itemsPerPage},a.to=function(){var b=a.currentPage*a.itemsPerPage+a.itemsPerPage;return b<a.rows()?b:a.rows()},a.prevPage=function(){a.currentPage>0&&a.currentPage--},a.prevPageDisabled=function(){return 0===a.currentPage?"disabled":""},a.nextPage=function(){a.currentPage<a.pageCount()&&a.currentPage++},a.nextPageDisabled=function(){return a.currentPage===a.pageCount()?"disabled":""},a.setPage=function(b){a.currentPage=b},a.$editLine=$('<ul class="pagination"><li ng-class="pconfig.prevPageDisabled()"><a href="" ng-click="pconfig.prevPage()">&#171;</a></li><li ng-class="{active: 0 == pconfig.currentPage}" ng-click="pconfig.setPage(0)"><a href="">1</a></li><li ng-repeat="n in pconfig.range()" ng-class="{active: n == pconfig.currentPage}" ng-click="pconfig.setPage(n)"><a href="">{{n+1}}</a></li><li ng-hide="pconfig.currentPage > pconfig.pageCount()-10" ng-click="pconfig.setPage(pconfig.pageCount())"><a href="">{{pconfig.pageCount()+1}}</a></li><li ng-class="pconfig.nextPageDisabled()"><a href="" ng-click="pconfig.nextPage()">&#187;</a></li></ul>'),$("#"+a.id).html(a.$editLine)}}]);